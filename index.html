<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindFlow - 本地化视觉思维导图</title>
    <meta name="description" content="一个基于浏览器的本地优先思维导图工具，支持图片与无限画布。">

    <!-- 样式表 -->
    <link rel="stylesheet" href="css/style.css">

    <!-- 第三方库 -->
    <!-- D3.js: 用于物理引擎布局 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- LocalForage: 用于简单的 IndexedDB 存储操作 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
</head>
<body>

<div class="app-container">
    <!-- 左侧边栏 -->
    <div class="sidebar closed" id="sidebar"> <!-- 默认移动端收起，桌面端视 CSS 而定，这里建议 JS 初始化决定，或者去掉 closed -->
        <div class="sidebar-header">
            <div class="brand">MindFlow</div>
            <div class="project-control">
                <select id="projSelect" class="project-select">
                    <option value="" disabled selected>正在加载...</option>
                </select>
                <button class="btn-icon" title="删除当前项目" onclick="app.ui.confirmDeleteProject()">🗑️</button>
            </div>
        </div>

        <div class="sidebar-content">
            <div id="resList" class="res-list">
                <!-- 资源列表将在这里动态生成 -->
                <div class="empty-tip">暂无资源</div>
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="btn-primary full-width" onclick="app.ui.openModal('resModal')">+ 添加参考资源</button>
        </div>
    </div>

    <!-- 主画布区域 -->
    <div class="main-area">
        <div class="toolbar">
            <button class="tool-btn" onclick="app.ui.toggleSidebar()" title="切换侧边栏">☰</button>
            <div class="divider"></div>
            <button class="tool-btn primary" onclick="app.graph.addRootNode()">🎯 根节点</button>
            <button class="tool-btn" onclick="app.graph.resetCamera()">🔎 归位</button>
            <div class="spacer"></div>
            <div id="saveStatus" class="status-text">就绪</div>
            <button class="tool-btn" onclick="app.storage.forceSave()">💾 保存</button>
            <button class="tool-btn danger" onclick="app.graph.clearAll()">🗑️ 清空</button>
        </div>

        <div class="canvas-wrapper" id="canvasWrapper">
            <canvas id="mainCanvas"></canvas>
        </div>
    </div>
</div>

<!-- 弹窗：添加资源 -->
<div class="modal-overlay" id="resModal" style="display: none;">
    <div class="modal-box">
        <h3>添加资源</h3>
        <div class="form-group">
            <label>类型</label>
            <select id="resType" class="form-input" onchange="app.ui.toggleResInput()">
                <option value="image">🖼️ 图片</option>
                <option value="video">🎬 视频</option>
                <option value="link">🔗 链接/文本</option>
            </select>
        </div>
        <div class="form-group">
            <label>名称</label>
            <input type="text" id="resName" class="form-input" placeholder="输入资源名称">
        </div>

        <!-- 文件上传区 -->
        <div class="form-group" id="groupFile">
            <label>文件 (支持大图，存储于本地)</label>
            <input type="file" id="resFile" class="form-input" accept="image/*">
        </div>

        <!-- 链接输入区 -->
        <div class="form-group" id="groupLink" style="display: none;">
            <label>内容</label>
            <input type="text" id="resContent" class="form-input" placeholder="https://...">
        </div>

        <div class="modal-actions">
            <button class="btn-text" onclick="app.ui.closeModal('resModal')">取消</button>
            <button class="btn-primary" onclick="app.data.addResource()">确认添加</button>
        </div>
    </div>
</div>

<!-- 悬浮菜单：节点编辑 -->
<div class="node-menu" id="nodeMenu" style="display: none;">
    <div class="form-group">
        <label>节点名称</label>
        <input type="text" id="nodeLabel" class="form-input">
    </div>
    <div class="form-group">
        <label>关联资源</label>
        <select id="nodeResSelect" class="form-input"></select>
    </div>
    <div class="menu-actions">
        <button class="btn-primary small" onclick="app.data.saveNodeEdit()">保存</button>
        <button class="btn-danger small" onclick="app.data.deleteNode()">删除节点</button>
    </div>
</div>

<!-- 提示框 -->
<div class="toast" id="toast"></div>

<!-- 应用逻辑 -->
<script src="js/app.js"></script>
<script>
    // 初始化时根据屏幕宽度决定是否收起侧边栏
    if (window.innerWidth < 768) {
        document.getElementById('sidebar').classList.add('closed');
    } else {
        document.getElementById('sidebar').classList.remove('closed');
    }
</script>
</body>
</html>